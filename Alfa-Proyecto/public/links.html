<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enlaces del usuario</title>
</head>
<body>
    <h2>Mis enlaces</h2>

    <button id="logout">Cerrar sesi贸n</button>

    <ul id="lista"></ul>

    <p id="error" style="color:red"></p>

<script>
async function cargarLinks() {
    const token = localStorage.getItem("token");
    const error = document.getElementById("error");

    if (!token) {
        alert("Debes iniciar sesi贸n");
        window.location.href = "index.html";
        return;
    }

    try {
        const res = await fetch("/api/links/mis-enlaces", {
            headers: { "Authorization": token }
        });

        if (res.status === 401) {
            error.textContent = "Sesi贸n expirada. Inicia sesi贸n de nuevo.";
            localStorage.removeItem("token");
            setTimeout(() => window.location.href = "index.html", 1500);
            return;
        }

        const data = await res.json();

        const lista = document.getElementById("lista");
        lista.innerHTML = "";

        if (!data.links || data.links.length === 0) {
            lista.innerHTML = "<li>No hay enlaces guardados</li>";
            return;
        }

        data.links.forEach(link => {
            const li = document.createElement("li");
            li.innerHTML = `<a href="${link}" target="_blank">${link}</a>`;
            lista.appendChild(li);
        });

    } catch (err) {
        error.textContent = "Error al cargar los enlaces.";
    }
}

document.getElementById("logout").addEventListener("click", () => {
    localStorage.removeItem("token");
    window.location.href = "index.html";
});

cargarLinks();
</script>

</body>
</html>
